{
    "collab_server" : "",
    "contents" : "---\ntitle: \"R Notebook\"\noutput: html_notebook\n---\n\n```{r setup}\nlibrary(ShlienLab.Core.Filter)\nlibrary(plotting.general)\nlibrary(reshape2)\n```\n\nHere we create a function to remove filtered mutation events that correspond to low coverage, low complexity regions and inclusion in a panel of normals.\n\n```{r internal_functions}\nhard_filter_data <- function(data = NULL, flagged_threshold = 2, pon_threshold = 2) {\n  data <- data %>%\n    filter(in_hard_clips == FALSE | in_soft_clips == FALSE) %>%\n    filter(flagged_count < flagged_threshold) %>%\n    filter(pon_count < pon_threshold)\n  return(data)\n  }\n\n```\n\n\n```{r load_data}\ndata_coverage <- data.frame(matrix(ncol=2, nrow=133))\ncolnames(data_coverage) <- c('mutect', 'mutect2')\nfor (i in 2:133) {\n  mutect_file <- paste(\n    sep='',\n    '/Volumes/adam_rodesktop_icgc/ewing_sarcoma_tirode/ref/titration_sim/',\n    i,\n    '_4094.rda'\n    )\n  mutect2_file <- paste(\n    sep='',\n    '/Volumes/adam_rodesktop_icgc/ewing_sarcoma_tirode/ref/titration_sim/',\n    i,\n    '_4094_mutect2.rda'\n    )\n  tmp_mutect <- load(mutect_file)\n  tmp_mutect <- get(tmp_mutect)\n  tmp_mutect2 <- load(mutect2_file)\n  tmp_mutect2 <- get(tmp_mutect2)\n  data_coverage[i,]$mutect <- nrow(hard_filter_data(data=tmp_mutect))\n  data_coverage[i,]$mutect2 <- nrow(hard_filter_data(data=tmp_mutect2))\n  }\n```\n\n\n```{r plot_data}\ndata_coverage$num_normals <- c(1:133)\ndata_mutation_count <- melt(data_coverage, id='num_normals', measure=c('mutect', 'mutect2'))\ncolnames(data_mutation_count) <- c('NumNormals', 'Algorithm', 'MutationCount')\n#create.scatterplot(data = data_coverage, x='num_pon', y='mutect2', xlab='Number of Normal Samples', ylab='MuTect2 Mut Count')\n\nplot <- data_mutation_count %>%\n  ggplot(aes(x=NumNormals, y=MutationCount, colour=Algorithm)) +\n  geom_point() +\n  xlab('Number of Normals') +\n  ylab('Mutation Count') +\n  theme_bw(base_size=24)\nwrite.plot(filename='~/Desktop/MuTect_MuTect2_PON_scatterplot.pdf', plot=plot, width=11, height=8)\n```\n\n\n# Analysis of 4094\nIn this section, we extract the data from sample 4094 for both MuTect and MuTect2 to determine the number of mutations removed based on the individual filtering criteria.\n\n```{r}\nfiltered_4094_table <- data.frame(matrix(ncol=3, nrow=6))\ncolnames(filtered_4094_table) <- c('MuTect', 'MuTect2', 'Type')\nfiltered_4094_table$Type <- c('total_snvs', 'standard_filters', 'complex_filter', 'pon_filter', 'clip_filter', 'final_snvs')\ndata_4094_mutect_total <- load('/Volumes/adam_rodesktop_largep/projects/ewing_sarcoma/analysis/snv/mutect/1.1.4/wgs/3952_4094/4094_annotated.rda')\ndata_4094_mutect_total <- get(data_4094_mutect_total)\nfiltered_4094_table[1,c('MuTect')] <- nrow(data_4094_mutect_total)\n\ndata_4094_mutect2_total <- load('/Volumes/adam_rodesktop_icgc/ewing_sarcoma_tirode/EGAD00001001051/tirode_indel/4094_indels/4094_annotated.rda')\ndata_4094_mutect2_total <- get(data_4094_mutect2_total)\nfiltered_4094_table[1, c('MuTect2')] <- nrow(data_4094_mutect2_total %>% filter(gatk_mutation_type == 'snv'))\n\n\n# filtered data analysis\ndata_4094_mutect <- load('/Volumes/adam_rodesktop_largep/projects/ewing_sarcoma/analysis/snv/mutect/1.1.4/wgs/3952_4094/4094_cfilter_pon.rda')\ndata_4094_mutect <- get(data_4094_mutect)\nfiltered_4094_table$MuTect[2] <- nrow(data_4094_mutect_total) - nrow(data_4094_mutect)\n\ndata_4094_mutect2 <- load('/Volumes/adam_rodesktop_icgc/ewing_sarcoma_tirode/EGAD00001001051/tirode_indel/4094_indels/4094_annotated_filtered_clipped.rda')\ndata_4094_mutect2 <- get(data_4094_mutect2)\nfiltered_4094_table$MuTect2[2] <- nrow(data_4094_mutect2_total %>% filter(gatk_mutation_type == 'snv')) - nrow(data_4094_mutect2)\n\n# complex filter\nfiltered_4094_table$MuTect[3] <- nrow(data_4094_mutect %>% filter(flagged_count >= 2))\nfiltered_4094_table$MuTect2[3] <- nrow(data_4094_mutect2 %>% filter(flagged_count >= 2))\n\n# PON filter\nfiltered_4094_table$MuTect[4] <- nrow(data_4094_mutect %>% filter(flagged_count >= 2) %>% filter(pon_count >= 2))\nfiltered_4094_table$MuTect2[4] <- nrow(data_4094_mutect2 %>% filter(flagged_count >= 2) %>% filter(pon_count >= 2))\n\n# clip filter\nfiltered_4094_table$MuTect[5] <- nrow(data_4094_mutect %>% filter(flagged_count >= 2) %>% filter(pon_count >= 2) %>% filter(in_soft_clips == TRUE | in_hard_clips == TRUE))\nfiltered_4094_table$MuTect2[5] <- nrow(data_4094_mutect2 %>% filter(flagged_count >= 2) %>% filter(pon_count >= 2) %>%  filter(in_soft_clips == TRUE | in_hard_clips == TRUE))\n```\n\n",
    "created" : 1493212375676.000,
    "dirty" : true,
    "encoding" : "",
    "folds" : "",
    "hash" : "1418344128",
    "id" : "84E40B6E",
    "lastKnownWriteTime" : 0,
    "last_content_update" : 1493221485889,
    "path" : null,
    "project_path" : null,
    "properties" : {
        "chunk_output_type" : "inline",
        "last_setup_crc32" : "",
        "tempName" : "Untitled2"
    },
    "relative_order" : 10,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}